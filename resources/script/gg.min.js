var slider=[],sliderDragging=false;var webInit=function(){if($('#calendar-event').length>0){var d=new Date();$('#calendar-event').responsiveCalendar({startFromSunday:true,allRows:false,onDayClick:function(events){var $el=$(this);var _date={day:$el.data('day'),month:$el.data('month'),year:$el.data('year')}
event=events[_date.year+'-'+_date.month+'-'+_date.day];$('#calendar-event .day').removeClass('hovered clicked');$el.parent().addClass('hovered');if(event&&event.dayEvents.length>0&&$el.parent().find('.day-events').length<1){var $dayEvents=$('<ul/>');$.each(event.dayEvents,function(key,val){$dayEvents.addClass('day-events').append('<li class="open-event" event-id="'+val.id+'"><span>'+val.hour+'</span> '+val.name+'</li>');});$el.parent().append($dayEvents);}if(event&&event.dayEvents.length==1){openEvent(event.dayEvents[0].id);}else if(event&&event.dayEvents.length>1){$el.parent().addClass('clicked');}},onDayHover:function(events){var $el=$(this);var _date={day:$el.data('day'),month:$el.data('month'),year:$el.data('year')}
event=events[_date.year+'-'+_date.month+'-'+_date.day];$('#calendar-event .day').removeClass('hovered clicked');$el.parent().addClass('hovered');if(event&&event.dayEvents.length>0&&$el.parent().find('.day-events').length<1){var $dayEvents=$('<ul/>');$.each(event.dayEvents,function(key,val){$dayEvents.addClass('day-events').append('<li class="open-event" event-id="'+val.id+'"><span>'+val.hour+'</span> '+val.name+'</li>');});$el.parent().append($dayEvents);}},onMonthChange:function(){var _x=this;window.setTimeout(function(){calendarEvent(_x.currentYear+'-'+(_x.currentMonth+1));},600);}});window.setTimeout(function(){calendarEvent(d.getFullYear()+'-'+(d.getMonth()+1));},600);}if($('.lightSlider').length>0){var sliderLoading=false,sliderNewContent=true;$('.lightSlider').each(function(sliderKey,sliderVal){slider[sliderKey]=$(this).lightSlider({item:1,vertical:true,verticalHeight:'auto',keyPress:false,controls:false,pager:false,slideMargin:0,onSliderLoad:function(el){el.children('li').show();var $parent=el.parents('.gg-list-container');$parent.find('.lp-ls').attr('data-slider',sliderKey);},onBeforeSlide:function(el){sliderDragging=true;},onAfterSlide:function(el){sliderDragging=false;var $parent=el.parents('.gg-list-container');var currIdx=el.getCurrentSlideCount();var reloadPager=function(__currIdx){if(__currIdx>5)__currIdx=5;$parent.find('.list-pager .lp-ls').each(function(key,val){var lpClass=key-__currIdx;var dataGoto=currIdx+lpClass;$(this).attr('data-idx',dataGoto);if(lpClass<0)lpClass*=-1;else lpClass+=2;var $lp=$(this);$lp.removeClass('lp-ls-1 lp-ls-2 lp-ls-3 lp-ls-4 lp-ls-5 lp-ls-x').addClass('lp-ls-'+lpClass);});}
var __reloadPager=function(){currIdx=el.getCurrentSlideCount();if(currIdx>3&&el.children('li').eq((currIdx+1)).length>0){reloadPager(3);$parent.find('.list-pager .lp-ls').eq(2).removeClass('lp-ls-1').addClass('lp-ls-2');window.setTimeout(function(){$parent.find('.list-pager .lp-ls').eq(2).removeClass('lp-ls-2').addClass('lp-ls-1');},200);}else if(currIdx>3){var _currIdx=-(el.children('li').length-currIdx)+5;reloadPager(_currIdx);}else{reloadPager(currIdx);}}
__reloadPager();if(el.children('li').eq((currIdx+1)).length<1&&!sliderLoading&&sliderNewContent){sliderLoading=true;var $lastEl=$parent.find('.ll-ink-sub').last();var lastPage=parseInt($lastEl.attr('data-page')),loadUri=$lastEl.attr('load-uri'),vpp=parseInt($lastEl.attr('data-vpp'));el.append('<li class="slider-loading"><i class="fa fa-circle-o-notch fa-spin"></i> Loading more data...</li>');el.refresh();$.get(loadUri+lastPage+'/'+vpp,function(response){if(response=='')sliderNewContent=false;sliderLoading=false;el.append(response);el.children('li').show();el.children('li.slider-loading').remove();el.refresh();__reloadPager();});}else if(!sliderNewContent){el.children('li.slider-loading').remove();el.refresh();__reloadPager();}}});});}if($('.lightSlider-h').length>0){$('.lightSlider-h').each(function(sliderKey,sliderVal){$(this).lightSlider({item:1,vertical:false,verticalHeight:'auto',keyPress:false,controls:false,pager:true,slideMargin:20,onSliderLoad:function(el){el.children('li').show();},onBeforeSlide:function(el){sliderDragging=true;},onAfterSlide:function(el){sliderDragging=false;}});});}if($('.select2').length>0)$('.select2').select2();if($('.ajax-form').length>0){$('.ajax-form').ajaxForm({dataType:'json',clearForm:false,resetForm:false,beforeSubmit:function(arr,$form,options){if($form.attr('disabled')=='disabled')return false;gotTo(0);if($form.find('.alert-danger').length>0)$form.find('.alert-danger').hide();},uploadProgress:function(event,position,total,percentComplete){},error:function(){var $form=$('.ajax-form');if($form.find('.alert-danger').length<=0)$form.prepend('<div class="alert alert-danger">Connection problem, please try again later.</div');else
$form.find('.alert-danger').html('Connection problem, please try again later.').show();if($form.hasClass('signup-form')){cntConfig();}},success:function(response,statusText,xhr,$form){if(response.status!=200){var message=(typeof response.message!='undefined')?response.message:'Internal server error, contact administrator.';if($form.find('.alert-danger').length<=0)$form.prepend('<div class="alert alert-danger">'+message+'</div');else
$form.find('.alert-danger').html(message).show();}else{if(typeof $form.attr('success-uri')!='undefined'){window.location.href=$form.attr('success-uri');}else{if($form.find('.alert-danger').length<=0)$form.prepend('<div class="alert alert-success">Data successfully saved.</div');else
$form.find('.alert-success').html('Data successfully saved.').show();}}if($form.hasClass('signup-form')){cntConfig();}}});}}
var webConfig=function(){cntConfig();if($('#content').height()<$(window).height()){$('footer').removeClass('static-footer');}else{$('footer').addClass('static-footer');}if($('#event-detail').length>0){$('#event-detail').css('top',$('#event-container').offset().top);}}
var cntConfig=function(){if($('#content-container').height()>$(window).height()){$('#content-container').css({position:'absolute',transform:'none',top:60,})}else{$('#content-container').css({position:'fixed',transform:'translateY(-50%)',top:'50%',});}}
var gotTo=function(pos,speed){if(typeof pos=='undefined')pos=0;if(typeof speed=='undefined')speed='normal';$('html, body').stop().animate({scrollTop:pos},speed);}
var openEvent=function(eventID){$('#calendar-event .day').removeClass('hovered clicked');var $panel=$('#event-container');var eventW=$panel.width(),eventH=$panel.height();if(eventW>460)eventW=460;if(eventH>400)eventH=400;$('#event-detail').css({top:$panel.offset().top,'margin-left':-(eventW/2),width:eventW,height:'auto'});$('#event-detail').html('<div class="panel-body"><div class="no-article"><i class="fa fa-circle-o-notch fa-spin"></i> Loading data...</div></div>').fadeIn();$('#event-detail .panel-body').css('min-height',eventH);$.get('/welcome/event_detail/'+eventID,function(response){$('#event-detail').html(response);$('#event-detail .panel-body').css('min-height',eventH);})}
var calendarEvent=function(date){$.getJSON('/welcome/jsonevent?date='+date,function(response){$('#calendar-event').responsiveCalendar('edit',response);});}
function readURL(input){if(input.files&&input.files[0]){var reader=new FileReader();reader.onload=function(e){$('#blah').css('background-image',"url('"+e.target.result+"')");}
reader.readAsDataURL(input.files[0]);}}function saveProfile(){$('.profile-form').submit();}$(document).ready(function(){webInit();webConfig();})
$(window).resize(function(){webConfig();})
$(document).scroll(function(){var scTop=$(document).scrollTop();})
var sidebarOpen=false;$(document).on('click','.open-sidebar',function(e){e.preventDefault();e.stopPropagation();if(!sidebarOpen){sidebarOpen=true;$('#sidebar').addClass('open');}else{sidebarOpen=false;$('#sidebar').removeClass('open');}});$(document).on('click','#sidebar',function(e){e.stopPropagation();});$(document).on('click',function(e){if(sidebarOpen){sidebarOpen=false;$('#sidebar').removeClass('open');}});$(document).on('click','.open-signup',function(e){});$(document).on('click','.go-to-top',function(e){e.preventDefault();gotTo(0);});$(document).on('click','.history-back',function(e){e.preventDefault();window.history.back();})
$(document).on('click','.view-points-history',function(e){e.preventDefault();var playerID=$(this).attr('player-id');$('#point-history').modal('show');$.get('/welcome/history/'+playerID,function(response){$('#point-history .modal-body').html(response);})})
$(document).on('click','.delete-profile-pic',function(e){e.preventDefault();if(confirm('Are you sure you want to remove your profile picture? you cant undo this action.')){$.getJSON('/welcome/deletepic',function(response){if(response.status==200){window.location.reload();}else{$('.profile-form .alert-danger').html(response.message).show();}})}});$(document).on('click','.enable-edit-password',function(e){e.preventDefault();var $el=$(this);$el.hide();$el.parent().find('.password').removeAttr('readonly').attr('placeholder','Change password').focus();$el.parent().find('.password2').show();})
$(document).on('click','.enable-edit-text',function(e){e.preventDefault();$(this).hide();$(this).parent().find('.form-control').removeAttr('readonly').focus().select();});$(document).on('click','.enable-edit-birth',function(e){e.preventDefault();$(this).hide();$(this).parent().find('.birth-editor').show();$(this).parent().find('.birth-readonly').hide();if($(this).parent().find('.select2').length>0){$(this).parent().find('.select2').select2();$(this).parent().find('.select2').select2('open');}if($(this).parent().find('.input-gov-id').length>0){$(this).parent().find('.input-gov-id').focus().select();}});$(document).on('click','.change-profile-pic',function(e){e.preventDefault();$('#input-profile-pic').trigger('click');});$(document).on('click','.open-article',function(e){if(!sliderDragging){e.preventDefault();var $el=$(this),articleID=$el.attr('article-id');$('#article-detail').attr('article-id',articleID).css({top:$el.offset().top,left:$el.offset().left,width:$el.width()+2,height:$el.height()+4});$('#article-detail').html($el.html()).show();$('#article-detail .panel-body').css({height:$el.height()-4});$.get('/welcome/tips_detail/'+articleID,function(response){$('#article-detail').html(response).find('.article-text').css({height:$('.article-main-container').height()-104})
$('#article-detail').stop().animate({top:$('.article-main-container').offset().top,height:$('.article-main-container').height()+64},'fast');})}});$(document).on('click','.close-article',function(e){var articleID=$('#article-detail').attr('article-id');var $article=$('.article-'+articleID);$('#article-detail').css({height:'auto'});$('#article-detail').animate({top:$article.offset().top},'fast');$('#article-detail .panel-body').animate({height:$article.height()-4},'fast',function(){$('#article-detail').hide();});});$(document).on('click','.open-event',function(e){if(!sliderDragging){e.preventDefault();var eventID=$(this).attr('event-id');openEvent(eventID);}});$(document).on('click','.close-event',function(e){$('#event-detail').fadeOut('fast');});$(document).on('click','.slider-gt',function(e){e.preventDefault();var $el=$(this);var gotoIdx=parseInt($el.attr('data-idx')),sliderIdx=parseInt($el.attr('data-slider'));$el.removeClass('lp-ls-1 lp-ls-2 lp-ls-3 lp-ls-4 lp-ls-5').addClass('lp-ls-x');slider[sliderIdx].goToSlide(gotoIdx);});$(document).on('click','.forgot-password',function(e){e.preventDefault();$('#login-form').attr('disabled','disabled');$('#login-form .alert').hide();$('.xlogin-container').fadeOut('fast',function(){$('.xforgot-container').fadeIn();});});$(document).on('click','.cancel-forgot',function(e){e.preventDefault();$('#login-form').removeAttr('disabled','disabled');$('.xforgot-container').fadeOut('fast',function(){$('.xlogin-container').fadeIn();});});$(document).on('click','.close-forgot',function(e){e.preventDefault();$('#login-form').removeAttr('disabled','disabled');$('.xforgot-sent').fadeOut('fast',function(){$('.xlogin-container').fadeIn();});});$(document).on('click','.forgot-password-btn',function(e){e.preventDefault();var $el=$(this);$el.attr('disabled','disabled').html('<i class="fa fa-circle-o-notch fa-spin"></i> Loading...');$.getJSON('/welcome/forgotpassword/'+$('#forgot-password-input').val(),function(response){if(response.status!=200){$el.removeAttr('disabled').html('Reset Password');$('#login-form .alert-danger').html(response.message).show();}else{$('.xforgot-container').fadeOut('fast',function(){$('.xforgot-sent').fadeIn();});}})});